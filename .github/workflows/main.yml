name: Ex0 - GIT and VS

on:
  push:
    branches:
      - main

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the code
      - uses: actions/checkout@v3

      # Step 2: Install dependencies
      - name: Install dependencies
        run: |
          sudo apt update
          sudo apt install -y git gcc g++ build-essential

      # Step 3: Build Part1Tester
      - name: Build Part1Tester
        working-directory: ./part1/queue
        run: |
          set -e
          g++ Part1Tester.cpp Queue.cpp -o part1_tester
          ls -la

      # Step 4: List files for debugging Part1Tester
      - name: Debug Part1Tester build
        run: ls -la ./part1/queue

      # Step 5: Run Part1 Tests
      - name: Run Part1 Tests
        run: |
          chmod +x ./part1/queue/part1_tester
          ./part1/queue/part1_tester || { echo "Executable not found during Part1 Tests"; exit 1; }

      # Step 6: Build Part2Tester
      - name: Build Part2Tester
        working-directory: ./part2
        run: |
          set -e
          g++ Part2Tester.cpp stack/LinkedList.cpp stack/Stack.cpp utils/Utils.cpp -o part2_tester
          ls -la

      # Step 7: List files for debugging Part2Tester
      - name: Debug Part2Tester build
        run: ls -la ./part2

      # Step 8: Run Part2 Tests
      - name: Run Part2 Tests
        run: |
          chmod +x ./part2/part2_tester
          ./part2/part2_tester || { echo "Executable not found during Part2 Tests"; exit 1; }

      # Step 9: Move Part1Tester to GitHub runner's temporary directory
      - name: Move Part1Tester to temp directory
        run: |
          mv ./part1/queue/part1_tester $RUNNER_TEMP/part1_tester
          chmod +x $RUNNER_TEMP/part1_tester

      # Step 10: Run Part1 Tests from temp directory (optional)
      - name: Run Part1 Tests from temp directory
        run: |
          $RUNNER_TEMP/part1_tester || { echo "Executable not found during Part1 Tests in temp directory"; exit 1; }

      # Step 11: Move Part2Tester to GitHub runner's temporary directory
      - name: Move Part2Tester to temp directory
        run: |
          mv ./part2/part2_tester $RUNNER_TEMP/part2_tester
          chmod +x $RUNNER_TEMP/part2_tester

      # Step 12: Run Part2 Tests from temp directory (optional)
      - name: Run Part2 Tests from temp directory
        run: |
          $RUNNER_TEMP/part2_tester || { echo "Executable not found during Part2 Tests in temp directory"; exit 1; }
